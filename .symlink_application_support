# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.osx` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &


USERNAME=jordan
HOME_DIR=/Users/$USERNAME
DROPBOX_DIR=/Users/$USERNAME/Google\ Drive
SYNCED_APPLICATION_SUPPORT_DIR=$DROPBOX_DIR/Application\ Support
APPLICATION_SUPPORT_DIR=/Users/$USERNAME/Library/Application\ Support

echo Symlinking Application Support directories from $SYNCED_APPLICATION_SUPPORT_DIR to $APPLICATION_SUPPORT_DIR...

for path in "$SYNCED_APPLICATION_SUPPORT_DIR"/*; do
  subdir="${path%/*}"
  basename="${path##*/}"
  if [ -e "$APPLICATION_SUPPORT_DIR/$basename" ]; then
    # echo Skipping $basename since it already exists locally
    echo Removing local $basename
    sudo rm -rf "$APPLICATION_SUPPORT_DIR/$basename"
  fi
  echo Symlinking $basename
  ln -s "$subdir/$basename" "$APPLICATION_SUPPORT_DIR/$basename"
done

echo Application Support directories symlinked successfully.

echo Symlinking ~/Downloads ~/Desktop ~/Documents
if [ -e "$HOME_DIR/Downloads" ]; then
  echo Stashing local Downloads
  sudo mv "$HOME_DIR/Downloads" "$HOME_DIR/Downloads_deleteme"
fi
echo Symlinking Downloads
ln -s "$DROPBOX_DIR/Downloads" "$HOME_DIR/Downloads"

if [ -e "$HOME_DIR/Desktop" ]; then
  echo Stashing local Desktop
  sudo mv "$HOME_DIR/Desktop" "$HOME_DIR/Desktop_deleteme"
fi
echo Symlinking Desktop
ln -s "$DROPBOX_DIR/Desktop" "$HOME_DIR/Desktop"

if [ -e "$HOME_DIR/Documents" ]; then
  echo Stashing local Documents
  sudo mv "$HOME_DIR/Documents" "$HOME_DIR/Documents_deleteme"
fi
echo Symlinking Documents
ln -s "$DROPBOX_DIR/Synced\ Documents" "$HOME_DIR/Documents"

